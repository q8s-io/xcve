<template>
  <div>
    <svg
      ref="svg"
      :width="width"
      :height="height"
      viewBox="0, 0, 200, 200"
      version="1.1"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
    >
      <defs>
        <svg id="mail" viewBox="0 0 1024 1024" width="100" height="100">
          <path
            d="M725.333333 0H196.266667C111.786667 0 42.666667 69.12 42.666667 153.6v716.8c0 84.48 69.12 153.6 153.6 153.6h631.466666c84.48 0 153.6-69.12 153.6-153.6V256L725.333333 0z m170.666667 870.4c0 37.546667-30.72 68.266667-68.266667 68.266667H196.266667c-37.546667 0-68.266667-30.72-68.266667-68.266667V153.6c0-37.546667 30.72-68.266667 68.266667-68.266667h409.6v221.866667c0 37.546667 30.72 68.266667 68.266666 68.266667h221.866667v494.933333zM708.266667 290.133333c-9.386667 0-17.066667-7.68-17.066667-17.066666V85.333333l204.8 204.8H708.266667z"
            p-id="8306"
          ></path>
          <path
            d="M588.8 716.8H298.666667c-23.893333 0-42.666667 18.773333-42.666667 42.666667s18.773333 42.666667 42.666667 42.666666h290.133333c23.893333 0 42.666667-18.773333 42.666667-42.666666s-18.773333-42.666667-42.666667-42.666667zM256 571.733333c0 23.893333 18.773333 42.666667 42.666667 42.666667h426.666666c23.893333 0 42.666667-18.773333 42.666667-42.666667s-18.773333-42.666667-42.666667-42.666666H298.666667c-23.893333 0-42.666667 18.773333-42.666667 42.666666z"
            p-id="8307"
          ></path>
        </svg>
        <svg id="package" viewBox="0 0 1024 1024" width="200" height="200">
          <path
            d="M782.605138 726.110449 655.120628 726.110449c-10.623965 0-15.935947-5.278213-15.935947-15.935947 0-10.623965 5.311982-15.935947 15.935947-15.935947l127.48451 0c39.84345 0 73.702606-13.94664 101.5877-41.831734 27.885094-27.89328 41.831734-61.753459 41.831734-101.5877 0-34.531468-10.955516-65.034179-32.865525-91.635023-21.910009-26.558889-50.134841-43.11496-84.658122-49.795103-10.623965-2.660596-14.609743-8.634658-11.949146-17.924231 1.326205-6.646374 1.988284-17.22736 1.988284-31.870872 0-57.0616-20.253276-105.863073-60.750619-146.411581-40.505529-40.505529-89.307002-60.750619-146.411581-60.750619-45.146223 0-86.314855 13.938454-123.497709 41.823548-37.182854 27.89328-62.416562 63.078641-75.691913 105.573477 0 5.311982-3.322675 9.29776-9.960863 11.958356-7.971555 0-13.283538-1.291412-15.935947-3.985778-18.59552-18.59552-41.831734-27.885094-69.716828-27.885094-29.219485 0-53.79009 9.952676-73.702606 29.873378-19.921725 19.921725-29.882588 44.526099-29.882588 73.702606 0 7.971555 0.663102 13.94664 1.988284 17.924231 0 7.971555-3.314489 13.94664-9.952676 17.932418-58.429761 23.899316-87.649246 67.727521-87.649246 131.470287 0 39.83424 13.94664 73.694419 41.831734 101.5877 27.885094 27.885094 61.753459 41.831734 101.5877 41.831734l223.097124 0c10.623965 0 15.935947 5.311982 15.935947 15.935947 0 10.657734-5.311982 15.935947-15.935947 15.935947L240.798275 726.110449c-49.132001 0-90.632183-16.938788-124.492362-50.797943-33.868365-33.860179-50.797943-75.360362-50.797943-124.492362 0-71.714322 31.870872-124.168997 95.612615-157.366074l0-9.960863c0-37.139875 13.283538-69.01177 39.84345-95.612615 26.558889-26.558889 58.429761-39.83424 95.612615-39.83424 26.558889 0 51.121308 7.300266 73.694419 21.910009 18.59552-45.112454 47.806819-81.343633 87.649246-108.565625 39.83424-27.180036 84.326571-40.828894 133.458571-40.828894 66.402339 0 122.835629 23.236214 169.316244 69.716828 46.480614 46.514383 69.716828 102.913904 69.716828 169.316244 0 9.289574-0.663102 16.641005-1.988284 21.910009 38.509059 10.665921 69.716828 31.582299 93.616144 62.748113 23.907503 31.199583 35.856649 66.724681 35.856649 106.568131 0 49.132001-16.929578 90.632183-50.797943 124.492362C873.237321 709.171662 831.737138 726.110449 782.605138 726.110449z"
          ></path>
        </svg>
        <svg id="arrow" viewBox="0 0 1024 1024" width="200" height="200">
          <path
            fill="red"
            d="M698.94167 538.861788 571.45716 411.378302l-1.988284 0c-1.326205-1.283226-2.660596-1.988284-3.985778-1.988284-3.985778-1.283226-7.963369-1.283226-11.949146 0-1.326205 0-3.322675 0.705058-5.975085 1.988284L420.074358 538.861788c-7.971555 7.971555-7.971555 15.935947 0 23.907503 7.963369 7.963369 15.935947 7.963369 23.899316 0l99.599416-101.5877 0 440.219163c0 10.657734 5.311982 15.935947 15.935947 15.935947s15.935947-5.278213 15.935947-15.935947L575.444984 461.181591l99.599416 101.5877c5.311982 2.694365 9.29776 3.985778 11.949146 3.985778 2.660596 0 6.638187-1.291412 11.949146-3.985778C706.913225 554.797735 706.913225 546.834366 698.94167 538.861788z"
          ></path>
        </svg>
      </defs>
      <g :id="status === 'end' ? 'package-boxs' : ''">
        <use
          xlink:href="#package"
          width="100"
          height="100"
          transform="translate(50, 10)"
        ></use>
        <g>
          <use
            xlink:href="#arrow"
            width="100"
            height="100"
            transform="translate(50, 10)"
          ></use>
          <animateTransform
            v-if="status === 'over'"
            attributeType="XML"
            attributeName="transform"
            type="translate"
            calcMode="spline"
            values="0, 10; 0, 0"
            keyTimes="0;1"
            keySplines=".14,.81,.33,.93"
            dur="1s"
            repeatCount="indefinite"
            fill="freeze"
          ></animateTransform>
        </g>
      </g>
      <template v-for="posi of posis">
        <g
          :key="posi.toString()"
          :transform="`translate(${posi[0]}, ${posi[1]})`"
        >
          <g>
            <g>
              <use xlink:href="#mail" width="40" height="40"></use>
              <animateTransform
                attributeType="XML"
                attributeName="transform"
                type="translate"
                from="0 0"
                :to="`${target[0] - posi[0]} 0`"
                dur=".7s"
                fill="freeze"
                additive="sum"
              ></animateTransform>
              <animateTransform
                attributeType="XML"
                attributeName="transform"
                type="scale"
                from="1"
                to=".5"
                dur=".7s"
                fill="freeze"
                additive="sum"
              ></animateTransform>
              <animate
                attributeName="opacity"
                attributeType="XML"
                from="1"
                to="0"
                dur=".7s"
                calcMode="spline"
                keyTimes="0 ; 1"
                keySplines=".47,.18,.82,.45"
                fill="freeze"
              ></animate>
            </g>
            <animateTransform
              attributeType="XML"
              attributeName="transform"
              type="translate"
              from="0 0"
              :to="`0 ${target[1] - posi[1]}`"
              dur=".7s"
              calcMode="spline"
              keyTimes="0 ; 1"
              keySplines=".47,.18,.82,.45"
              fill="freeze"
            ></animateTransform>
          </g>
        </g>
      </template>
    </svg>
  </div>
</template>
<script>
const colorList = [
  ["#8a8a8a", "#EFEBE9", "#8a8a8a", "#8a8a8a"],
  ["#0288D1", "#EFEBE9", "#039BE5", "#29B6F6"]
];
const posiList = [
  [20, 130],
  [60, 150],
  [100, 150],
  [140, 130],
  [160, 120]
];
export default {
  name: "BiMail",
  mounted() {
    this.svg = this.$refs.svg;
  },
  data() {
    return {
      svg: null,
      posis: [],
      packageColor: colorList[0],
      target: [90, 80]
    };
  },
  props: {
    width: {
      type: String,
      default: "500"
    },
    height: {
      type: String,
      default: "500"
    },
    status: {
      type: String,
      default: "nothing"
    }
  },
  methods: {},
  watch: {
    status(state) {
      if (state !== "end") {
        this.posis = [];
      } else {
        this.svg.setCurrentTime(0);
        this.posis.push(...posiList);
      }
    }
  }
};
</script>
<style>
#package-boxs {
  transform-origin: center;
  animation: move 3s 0.7s linear normal forwards;
}
@-webkit-keyframes move {
  20%,
  from,
  to {
    transform: scale3d(1, 1, 1);
  }

  2%,
  4% {
    transform: scale3d(0.95, 0.95, 0.95) rotate3d(0, 0, 1, -3deg);
  }

  10%,
  14%,
  18%,
  6% {
    transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, 3deg);
  }
  12%,
  16%,
  8% {
    transform: scale3d(1.05, 1.05, 1.05) rotate3d(0, 0, 1, -3deg);
  }
}
</style>
